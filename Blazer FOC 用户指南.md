# Blazer FOC 用户指南

## 前言

​		无刷电机广泛应用于机器人领域，相比直流有刷电机，具有结构简单，转矩大，响应快，精度高等优点。要实现优异的运动控制效果，不仅需要电机本身的特性足够良好，更取决于驱动器的性能。传统的方波电调操作简单，可兼容大部分电机，但难以做到细腻的控制效果，很多情况下无法满足机器人的需求，使用了**FOC**（**field-oriented control**）的驱动，能够对电机进行力矩、速度和位置的三环控制，响应速度和控制精度都是传统电调无法比拟的。

​		Blazer FOC始于2023年，由西安交通大学**机器人俱乐部**（**Robocon**）提供研发支持，WJY完成初代版本的软硬件开发。研制该驱动的目的在于对现有的成品驱动实现自主化替代，降低使用门槛，并节省费用开销。目前已实现的大功率叠层版本（60A），针对适配的电机，可以完成有位置传感器的电流环、速度环和位置环。单板中功率已完成硬件设计，功能待测试。

## 一、功能介绍

### 1.已有功能

> 基础有感FOC算法 电流 速度 位置 可控

> 编码器零偏校准

> 电机极对数辨识

> 电机电阻电感辨识

> OLED+按键离线操作

> CAN通信控制

> 支持绝对式SPI编码器 TLE5012B MT6816

> 过压、欠压保护

> 编码器断连识别

### 2.尚待开发

> 更多可适配编码器

> 无位置传感器算法

> 磁编码器偏心补偿

> 速度规划

> 前馈控制

> USB虚拟串口通信

> Blazer FOC上位机

### 3.注意事项

> 驱动供电电压为**3S-6S**，外部电源超过30V可能会引发器件过压损坏。

> **极对数辨识**功能对于超过**20对极**的电机可能产生误判，导致电机无法正常运行，因此最保险的方式是直接用CAN设置电机的极对数。

> 驱动属于强电设备，使用时请按照说明正确配置，否则电机可能会出现失控跑飞的情况。

**驱动仍处于研发阶段，实际使用中可能存在一些问题，还请谅解。如遇明显失控的情况，可向开发者反馈**

## 二、硬件设计

### 1.元件选型

MCU : **STM32F405RGT6**

栅极驱动 : **FD6288Q**

MOSFET : **HYG006N04LS1TA** 40V 600A 或 **HYG011N04LS1TA** 40V 320A

采样电阻 : **1mΩ** **3920**

电流感应放大器 : **INA240A1PWR**

磁编码器 : **TLE5012BE1000** 或 **MT6816-STD**

屏幕 :  **0.78寸OLED SH1107**



### 2.整体布局







## 二、使用方法



### 2.参数定义



### 3.CAN协议

Blazer FOC使用扩展帧进行CAN通信，帧ID由节点ID和参数ID组成，格式为

​                                                         **==ID段：节点ID<<8 | 参数ID  数据段：32位float==**



### 3.UART协议







